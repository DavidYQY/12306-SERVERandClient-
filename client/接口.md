## 接口及进展
updated 2016/8/29 21:40:15 
### 符号说明

```
->    server->client
<-    client->server
倾斜接口表示已实现
```
### 用户信息

#### LogIn 

*<-* : *"login"*,*"aaa-bbb"*
```c++
今天在数据库里加了简单的数据：
User: cherry-aaa
Administrator:cherry-979988
```
*->*:*success*

-> 
```c++
*User*
cherry-aaa-叶沁媛-1-310104199709091234-13141344286-中国-Adult-null//null 就是空
*Administrator*
*cherry-979988-叶沁媛-13141344286-Boss*
```
需不需要一起传下次讨论。数据库结构有异议快点提出，否则就真的别动了，累。
-> *xuser*
-> *xpasswd*
-> *server unexpected error!*
收到这个是我的锅

#### register
< -
*cherry-aaa-叶沁媛-Male-1997-9-9-中国-310104199709091234-13141344286-Adult-清华大学-2015011469*
```c++
前面还是加个register
另外...Adult后面的信息别用-了，算在一起吧，我这里都叫addition
生日别发了，不打算存，增加难度。（貌似要储存的话是叫date？）
你客户端需要的话身份证号做个处理吧233
所以建议是这样发
> cherry-aaa-叶沁媛-Male-中国-310104199709091234-13141344286-Adult-清华大学,2015011469
> 注意最后是逗号哦。这个附加信息在我这里算在addition
```
-> *success* 
-> *xusername*
-> *xID*
-> *server unexpected error!*
收到这个是我的锅。
注册功能已经按“cherry-aaa-叶沁媛-Male-中国-310104199709091234-13141344286-Adult-清华大学,2015011469”实现

### 买票
#### 查询列车
//符合条件的所有信息 
#### 某一车次
//几点停在哪里

### 其他已经实现接口
*连接成功 -> LinkSuccess*
*请客户端断开连接 -> Disconnected*

### 目前bug

#### 两个客户端登录时间间隔不能太短（小于20ms）
不打算修这个bug，概率太小。我是开2个线程同时登陆测试时发现这个bug的。
换句话说，我自己写的这个服务器别人要攻击还是超级简单的。真正的服务器耐压能力必须很强。
用zwt的话说“有本事你release出来啊，老子分分钟操爆你的服务器”。
第一次写这种东西，有bug还是可以接受的嘛^_^

#### socket连续传数据
很遗憾，真的会并到一条里发，例如
> successAdministratorcherry-979988-叶沁媛-310104199709091234-Boss
明明是success / Administrator / ...

解决方案无非几个：
- 重新定义传输协议（网上说法）

这个是指在传数据前加点东西制定数据长度
- 索性变成一条字符串

但这个后面的车次信息肯定还是有问题的，那个一次肯定传不完吧。
- sleep

这个解决方法“非常危险”，在一个客户端的情况下应该可以解决问题（但代价也是变慢好多，每两个连续传输必须加sleep(40)），但是如果有几个客户端，这个绝对会打乱服务器正常节奏（sleep的原理是整个程序休息40ms.。）

### 目前想到后续(全部做完)后可以改进的
#### 客户端
- 用户名密码需要屏蔽“-”和引号,否则一传输乱套了。

#### 服务端
- 应该多一个“显示当前在线客户功能”，而不是全放在一张表里。应该记录每个用户在不同客户端登录的ip(descriptor)
- 数据库应该也可以远程连接
